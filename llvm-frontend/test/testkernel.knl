/* Builtins defined by library. */
__builtin__ float max(float, float);
__builtin__ vec2 max(vec2, vec2);
__builtin__ vec3 max(vec3, vec3);
__builtin__ vec4 max(vec4, vec4);
__builtin__ void putchar(int);
__builtin__ void putfloat(float);

/* Prototype for functions defined below. */
float increment(float a);
float increment(float a, float by);
vec2 increment(vec2 a);
vec2 increment(vec2 a, float by);

/* Our actual kernel. */
kernel vec4 simpleKernel()
{
  float a = max(2.0, 1.0);
  float b = increment(a);
  vec2 c = vec2(3,b);
  return vec4(increment(vec2( increment(a, 3), b ), 2), increment(c));
}

/* Output a vector to stdout */
void putvec(vec4 v)
{
  const int comma = 44;
  putfloat(v.x); putchar(comma);
  putfloat(v.y); putchar(comma);
  putfloat(v.z); putchar(comma);
  putfloat(v.w); 
}

// HACK: __builtin__ also defines external linkage meaning this
// becomes our program's 'main' function.
__builtin__ int main()
{
  int newline = 10;
  vec4 kernel_output = simpleKernel();
  putvec(kernel_output); putchar(newline);
  return 0;
}

float increment(float a)
{
  return a + 1;
}

float increment(float a, float by)
{
  return a + by;
}

vec2 increment(vec2 a)
{
  return a + vec2(1,1);
}

vec2 increment(vec2 a, float by)
{
  // Auto broadcast of vector/floating point operations.
  return a + by;
}

// vim:filetype=c
