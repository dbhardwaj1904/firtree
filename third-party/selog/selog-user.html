          <!-- manual page source format generated by PolyglotMan v3.2, -->
<!-- available at http://polyglotman.sourceforge.net/ -->

<html>
<head>
<title>selog(7) manual page</title>
</head>
<body bgcolor='white'>
<a href='#toc'>Table of Contents</a><p>
 
<h2><a name='sect0' href='#toc0'>Name</a></h2>
selog - selective logging configuration  
<h2><a name='sect1' href='#toc1'>Description</a></h2>
 Selog
is a library of routines for error reporting, activity logging, and debug
tracing. It gives users flexible control over which messages are written
and where they are written to. <p>
Messages are classified using &ldquo;selectors&rdquo; 
that determine their priority level (e.g. debug or info or error, etc.) and
category (the part of the program that they relate to). You can selectively
enable or disable messages based on their selectors using a simple textual
configuration. In some cases you may be given fine control over the verbosity
of a message, beyond just switching it on or off, using separate selectors
that control optional parts of the message. <p>
Enabled messages are written
to one or more channels, as specified by the configuration. Several kinds
of channel are supported, including the standard error stream, syslog,
files, etc. You can configure selog to write messages with different selectors
to different sets of output channels. <p>
This manual describes how you can
configure selog, and the behaviour of selog&rsquo;s output channels. The programmer&rsquo;s
interface to selog is described in <i><b>selog</b>(3)</i>, as are the auxiliary libraries
that can be used to replace the standard <i><b>err</b>(3)</i> and <i><b>syslog</b>(3)</i> interfaces
with implementations based on selog.  
<h2><a name='sect2' href='#toc2'>Configuration</a></h2>
Given a selector defined
by the program, selog needs to determine (for message selectors) where
messages controlled by the selector are to be written, or (for option selectors)
whether the selector is enabled or not. To do this, it scans the configuration
string provided by the user, which comprises a sequence of selection items
and channel items. <p>
The selector has a notional on/off state which is manipulated
as the configuration string is scanned. The initial state of a message selector
is on iff its level is &ldquo;info&rdquo;  or above. (That is, there is an implicit &ldquo;+default&rdquo;
 at the start of the configuration string.) Option selectors can start in
either state. <p>
If the selector matches a selection item, it is switched on
or off according to whether the first character of the item is &ldquo;+&rdquo; or &ldquo;-&rdquo;. If
the selector does not match a selection item then its state remains unchanged.
<p>
If the selector is on when a channel item is encountered, then messages
controlled by the selector are written to the channel specified by the
item. If there are trailing selection items not followed by a channel item,
then selog appends an implicit &ldquo;@stderr&rdquo;  channel item. <p>
An option selector
is enabled if it is enabled for any channel, and disabled only if it is
disabled for all channels. This implies that it is best to group option
selection items at the start of the configuration string, so that turning
off a default-on option works as expected.  
<h3><a name='sect3' href='#toc3'>Syntax</a></h3>
The formal syntax is described
using ABNF (RFC 4234). <p>
Items may be terminated by semicolons, which are
optional except between a channel item and a following selection item. White
space may be freely inserted between tokens. Space is only required to separate
the arguments of a channel item. <table border='0'>
<tr><td align='left'></td><td align='left'>config</td><td align='left'> = </td><td align='left'>SP selection channel ";") selection
channel</td></tr>
<tr></tr>
<tr><td align='left'></td><td align='left'>space</td><td align='left'> =</td><td align='left'>%x20 / %x09 / %x0A / %x0D</td></tr>
<tr><td align='left'></td><td align='left'>SP</td><td align='left'> =</td><td align='left'>*<i>space</i></td></tr>
<tr><td align='left'></td><td align='left'>SEP</td><td align='left'> =</td><td align='left'>1*<i>space</i></td></tr>
<tr><td align='left'></td><td align='left'>TERM</td><td align='left'> =</td><td align='left'>*(<i>space</i>
/ ";")</td></tr>
</table>
 
<h3><a name='sect4' href='#toc4'>Selection items</a></h3>
A selection item starts with a &ldquo;+&rdquo; if it is to enable
selectors, or a &ldquo;-&rdquo; if it is to disable them. If this is followed by a category
name then only selectors with the given name will match. <p>
The category name
may be followed by a level comparison. If the operator is &ldquo;&lt;&rdquo; then the selector
matches if its level is less than or equal to the given level. If the operator
is &ldquo;=&rdquo; then the selector matches if its level is the same as the given level.
If the operator is &ldquo;&gt;&rdquo; or &ldquo;.&rdquo; then the selector matches if its level is greater
than or equal to the given level. If the comparison is omitted then it is
equivalent to &ldquo;&gt;all&rdquo;. <p>
If the category name is omitted, any selector matches
if its level matches. In this case a &ldquo;&gt;&rdquo; comparison operator can be omitted.
<table border='0'>
<tr><td align='left'></td><td align='left'>selection</td><td align='left'> = </td><td align='left'>sign category compare level TERM</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> /</td><td align='left'>sign category TERM</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> /</td><td align='left'>sign
compare level TERM</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> /</td><td align='left'>sign level TERM</td></tr>
<tr></tr>
<tr><td align='left'></td><td align='left'>sign</td><td align='left'> =</td><td align='left'>("+" / "-") <i>SP</i></td></tr>
<tr><td align='left'></td><td align='left'>compare</td><td align='left'> =</td><td align='left'>("&lt;" / "="
/ "&gt;" / ".") <i>SP</i></td></tr>
<tr></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> ;</td><td align='left'>In order of increasing priority:</td></tr>
<tr><td align='left'></td><td align='left'>level</td><td align='left'> = </td><td align='left'>"trace"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> / </td><td align='left'>"debug"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'>
/ </td><td align='left'>"all" / "option" / "option_off" / "opt_off"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> / </td><td align='left'>"verbose"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> / </td><td align='left'>"default" /
"option_on" / "opt_on"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> / </td><td align='left'>"info"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> / </td><td align='left'>"notice"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> / </td><td align='left'>"warning" / "warn"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> / </td><td align='left'>"error"
/ "err"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> / </td><td align='left'>"critical" / "crit"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> / </td><td align='left'>"alert"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> / </td><td align='left'>"emergency" / "emerg"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> / </td><td align='left'>"fatal"
/ "exit"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> / </td><td align='left'>"abort"</td></tr>
<tr></tr>
<tr><td align='left'></td><td align='left'>category</td><td align='left'> =</td><td align='left'>*<i>catchar SP</i></td></tr>
<tr><td align='left'></td><td align='left'>catchar</td><td align='left'> =</td><td align='left'>%x21-2A / %x2C / %x2F-3A
/ %x3F / %x41-7E / %x80-FF</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> ;</td><td align='left'>all visible characters except + - . ; &lt; = &gt; @</td></tr>
<tr></tr>
</table>
Option
selectors are distinguished from message selectors by having one of two
special levels. The &ldquo;default&rdquo;  level is used for options that are on by default,
and the &ldquo;option&rdquo;  level is used for options that are off by default. So, for
example, you can turn on all options without turning on &ldquo;verbose&rdquo;  messages
using the selection item &ldquo;+=option&rdquo;.  The level name &ldquo;all&rdquo;  is a synonym for
&ldquo;option&rdquo;  that is useful when you want to enable all non-debug message selectors
and all option selectors. Message selectors with a higher level than &ldquo;default&rdquo;
 are also on by default.  
<h3><a name='sect5' href='#toc5'>Channel items</a></h3>
A channel item starts with an &ldquo;@&rdquo; and
a keyword indicating what kind of channel it is. If the keyword is not recognised
then if it starts with a &ldquo;/&rdquo;  it is treated as the first argument following
a &ldquo;file&rdquo;  keyword, and if it starts with a &ldquo;|&rdquo;  the rest is treated as the first
argument following a &ldquo;pipe&rdquo;  keyword. (In other words, &ldquo;file&rdquo;  keywords can
be omitted, and &ldquo;|&rdquo;  is a synonym for &ldquo;pipe&rdquo;.)  The keyword may be followed by
space-separated arguments as required. The details of each kind of channel
are described in the next section. <table border='0'>
<tr><td align='left'></td><td align='left'>channel</td><td align='left'> =</td><td align='left'>"@" SP kind SEP argument TERM</td></tr>
<tr></tr>
<tr><td align='left'></td><td align='left'>kind</td><td align='left'>
=</td><td align='left'>"file"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> /</td><td align='left'>"pipe"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> /</td><td align='left'>"rotate"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> /</td><td align='left'>"stderr"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> /</td><td align='left'>"stdout"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> /</td><td align='left'>"syslog"</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> /</td><td align='left'>"|" <i>argument</i></td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> /</td><td align='left'><i>argument</i></td></tr>
<tr></tr>
<tr><td align='left'></td><td align='left'>argument</td><td align='left'>
=</td><td align='left'>*<i>argchar</i></td></tr>
<tr><td align='left'></td><td align='left'>argchar</td><td align='left'> =</td><td align='left'>%x21-3A / %x3C-3F / %x41-7E / %x80-FF</td></tr>
<tr><td align='left'></td><td align='left'></td><td align='left'> ;</td><td align='left'>all visible characters
except ; @</td></tr>
</table>
 
<h2><a name='sect6' href='#toc6'>Channels</a></h2>
The following sub-sections describe the details of each
kind of channel, the arguments they require after their keywords in the
configuration string, and any differences from the usual message format
described in the next section.  
<h3><a name='sect7' href='#toc7'>stderr</a></h3>
The <i>stderr</i> channel writes its messages
to the standard error stream (file descriptor 2). It takes no arguments.
The time stamp and host name are omitted.  
<h3><a name='sect8' href='#toc8'>stdout</a></h3>
The <i>stdout</i> channel writes
its messages to the standard output stream (file descriptor 1) and is otherwise
the same as the <i>stderr</i> channel.  
<h3><a name='sect9' href='#toc9'>file</a></h3>
The <i>file</i> channel&rsquo;s first argument is
an absolute path to the log file. (Because arguments are separated with
white space, the path name cannot contain spaces.) It takes an optional
second argument which is the numeric access mode to be used when creating
the file. The default mode is 0666. The mode is affected by the process&rsquo;s
umask setting. <p>
Messages are appended in a way that is compatible with multiple
programs logging to the same file concurrently. Selog automatically re-opens
the file when it detects that it has been moved aside, so there is no need
to HUP the process(es) when the log is rotated. If the <b>log_rotate</b> option
is enabled then the <i>file</i> channel behaves like the <i>rotate</i> channel. <p>
The host
name is ommitted from the messages.  
<h3><a name='sect10' href='#toc10'>rotate</a></h3>
The <i>rotate</i> channel is very similar
to the file channel, except that it automatically opens a new log file
at midnight. The given file name has a date stamp appended in the format
&ldquo;<b>.YYYY-MM-DD</b>&rdquo;.  By default midnight is local time, unless the <b>log_zulu</b> option
is enabled.  
<h3><a name='sect11' href='#toc11'>pipe</a></h3>
The arguments to the <i>pipe</i> channel are a command-line that
is passed to the shell to start a sub-process. Messages are written to the
sub-process&rsquo;s standard input stream via a pipe.  
<h3><a name='sect12' href='#toc12'>syslog</a></h3>
The <i>syslog</i> channel
takes a single argument which is a syslog facility name, i.e. one of: <table border='0'>
<tr><td align='left'></td><td align='left'>user</td><td align='left'>uucp</td><td align='left'>local1</td><td align='left'>local0</td></tr>
<tr><td align='left'></td><td align='left'>mail</td><td align='left'>cron</td><td align='left'>local2</td></tr>
<tr><td align='left'></td><td align='left'>daemon</td><td align='left'>authpriv</td><td align='left'>local3</td></tr>
<tr><td align='left'></td><td align='left'>auth</td><td align='left'>ftp</td><td align='left'>local4</td></tr>
<tr><td align='left'></td><td align='left'>syslog</td><td align='left'>ntp</td><td align='left'>local5</td></tr>
<tr><td align='left'></td><td align='left'>lpr</td><td align='left'>security</td><td align='left'>local6</td></tr>
<tr><td align='left'></td><td align='left'>news</td><td align='left'>console</td><td align='left'>local7</td></tr>
</table>
<p>
Messages
are written to the system log socket using the facility specified by the
channel configuration and a severity derived from the message selector.
Most selog levels map directly to syslog severities. Those that do not map
as follows: <table border='0'>
<tr><td align='left'></td><td align='left'>SELOG_TRACE</td><td align='left'>LOG_DEBUG</td></tr>
<tr><td align='left'></td><td align='left'>SELOG_VERBOSE</td><td align='left'>LOG_INFO</td></tr>
<tr><td align='left'></td><td align='left'>SELOG_FATAL</td><td align='left'>LOG_CRIT</td></tr>
<tr><td align='left'></td><td align='left'>SELOG_ABORT</td><td align='left'>LOG_ALERT</td></tr>
</table>
<p>
The
time stamp is in the standard syslog format and is in local time unless
the <b>log_zulu</b> option is set. The host name is omitted because <i><b>syslogd</b>(8)</i>
adds it when necessary.  
<h2><a name='sect13' href='#toc13'>Message Format</a></h2>
As well as determining where messages
are written, the channel type also affects the format of the message prefix.
For example, syslog has its own time stamp format. Messages written by selog
follow the same general scheme, though parts are often omitted depending
on the particular message and the channel it is written to. <table border='0'>
<tr><td align='left'></td><td align='left'>time host prog[pid]
file:line func() name level: message: error</td></tr>
</table>

<dl>

<dt><i>time</i> </dt>
<dd>The time the message was
written. Except for syslog, the format is similar to ISO 8601 / RFC 3339.
(For readability the &ldquo;T&rdquo;  separator is replaced with a space and a space
is added before the time zone). <br>
<b>YYYY-MM-DD hh:mm:ss.fff +ZZ:ZZ</b> <table border='0'>
<tr><td align='left'>YYYY</td><td align='left'>year</td><td align='left'>2008</td></tr>
<tr><td align='left'>MM</td><td align='left'>month</td><td align='left'>04</td></tr>
<tr><td align='left'>DD</td><td align='left'>day</td><td align='left'>30</td></tr>
<tr><td align='left'>hh</td><td align='left'>hour</td><td align='left'>23</td></tr>
<tr><td align='left'>mm</td><td align='left'>minute</td><td align='left'>01</td></tr>
<tr><td align='left'>ss</td><td align='left'>second</td><td align='left'>59</td></tr>
<tr><td align='left'>fff</td><td align='left'>fraction</td><td align='left'>.500</td></tr>
<tr><td align='left'>ZZZZ</td><td align='left'>time
zone</td><td align='left'>+01:00</td></tr>
</table>
</dd>

<dt>Fractional seconds are usually omitted. </dt>
<dd>They can be enabled to
millisecond precision using the <b>log_msec</b> option, and to microsecond precision
using the <b>log_usec</b> option. </dd>

<dt>By default the time stamp is in local time. </dt>
<dd>Positive
time zone offsets are ahead of UTC (East of Greenwich). You can choose UTC
time stamps using the <b>log_zulu</b> option, in which case the time zone is written
as &ldquo;Z&rdquo;  instead of as a numeric offset. You can omit the time zone by turning
off the <b>log_tz</b> option, though this is unwise especially if you are logging
local time in a place which is subject to daylight saving variations. </dd>

<dt><i>host</i>
</dt>
<dd>The fully-qualified host name of the machine that generated the message.
</dd>

<dt><i>prog[pid]</i> </dt>
<dd>The program name and process ID. The pid field is turned on using
the <b>log_pid</b> option. </dd>
</dl>
<p>
The precise format of the preceding fields, and whether
or not they are present, depends on the channel, as described in the previous
section. The presence of the following fields depends on the message. 
<dl>

<dt><i>file:line</i>
</dt>
<dd>The source code file and line number where the message is generated. This
is usually omitted except by &ldquo;trace&rdquo;  messages. </dd>

<dt><i>func()</i> </dt>
<dd>The source function
where the message is generated. This is usually omitted except by &ldquo;trace&rdquo;
 messages. </dd>

<dt><i>func()</i> </dt>
<dd>The source function where the message is generated. This
is usually omitted except by &ldquo;trace&rdquo;  messages. </dd>

<dt><i>name</i> </dt>
<dd>The message selector&rsquo;s
category name. </dd>

<dt><i>level</i> </dt>
<dd>The message selector&rsquo;s level. </dd>

<dt><i>mesage</i> </dt>
<dd>The main part of
the message, which has no particular format. </dd>

<dt><i>error</i> </dt>
<dd>Operating system errors
are generally added to the end of the message after a colon.  </dd>
</dl>

<h2><a name='sect14' href='#toc14'>Diagnostics</a></h2>
This
section lists the built-in selectors used by selog itself. Selectors are
written <b>{</b><i>category</i><b>, </b><i>LEVEL</i><b>}.</b> 
<dl>

<dt><b>{log_config, ERROR}</b> </dt>
<dd>This is used by selog to
report configuration syntax errors. Because it is used before selog is fully
initialized, the messages it controls are always written to the standard
error stream. </dd>

<dt><b>{log_msec, OPTION_OFF}</b> </dt>
<dd>For logging time stamps to millisecond
accuracy. Overridden by <i>log_usec.</i> </dd>

<dt><b>{log_panic, FATAL}</b> </dt>
<dd>If an error occurs when
selog is writing a message, it tries to write the error using the <i>log_panic</i>
selector before exiting the program. </dd>

<dt><b>{log_pid, OPTION_OFF}</b> </dt>
<dd>For enabling
the process ID field. </dd>

<dt><b>{log_rotate, OPTION_OFF}</b> </dt>
<dd>For enabling auto-rotation
of <i>file</i> channels. </dd>

<dt><b>{log_tz, OPTION_ON}</b> </dt>
<dd>For disabling the time zone field.
This is unwise especially if you are logging local time in a place which
is subject to daylight saving variations. </dd>

<dt><b>{log_usec, OPTION_OFF}</b> </dt>
<dd>For logging
time stamps to millisecond accuracy. Overrides <i>log_msec.</i> </dd>

<dt><b>{log_zulu, OPTION_OFF}</b>
</dt>
<dd>For logging in UTC instead of local time.  </dd>
</dl>

<h2><a name='sect15' href='#toc15'>Environment</a></h2>

<dl>

<dt><b>SELOG_CONFIG</b> </dt>
<dd>Overrides
the configuration string passed to selog by the program.  </dd>
</dl>

<h2><a name='sect16' href='#toc16'>See Also</a></h2>
<i><b>selog</b>(3)</i>,
<i><b>syslogd</b>(8)</i> <p>
RFC 5234: Augmented BNF for Syntax Specifications: ABNF, <br>
by Dave Crocker (ed.), Paul Overell, January 2008. <p>
RFC 3339: Date and time
on the Internet: Timestamps, <br>
by Graham Klyne (ed.), Chris Newman, July 2002.  
<h2><a name='sect17' href='#toc17'>Author</a></h2>
Written by Tony Finch
&lt;dot@dotat.at&gt; &lt;fanf2@cam.ac.uk&gt; <br>
at the University of Cambridge Computing Service. <br>
Source available from &lt;<i>http://dotat.at/prog/selog</i>&gt;   <p>

<hr><p>
<a name='toc'><b>Table of Contents</b></a><p>
<ul>
<li><a name='toc0' href='#sect0'>Name</a></li>
<li><a name='toc1' href='#sect1'>Description</a></li>
<li><a name='toc2' href='#sect2'>Configuration</a></li>
<ul>
<li><a name='toc3' href='#sect3'>Syntax</a></li>
<li><a name='toc4' href='#sect4'>Selection items</a></li>
<li><a name='toc5' href='#sect5'>Channel items</a></li>
</ul>
<li><a name='toc6' href='#sect6'>Channels</a></li>
<ul>
<li><a name='toc7' href='#sect7'>stderr</a></li>
<li><a name='toc8' href='#sect8'>stdout</a></li>
<li><a name='toc9' href='#sect9'>file</a></li>
<li><a name='toc10' href='#sect10'>rotate</a></li>
<li><a name='toc11' href='#sect11'>pipe</a></li>
<li><a name='toc12' href='#sect12'>syslog</a></li>
</ul>
<li><a name='toc13' href='#sect13'>Message Format</a></li>
<li><a name='toc14' href='#sect14'>Diagnostics</a></li>
<li><a name='toc15' href='#sect15'>Environment</a></li>
<li><a name='toc16' href='#sect16'>See Also</a></li>
<li><a name='toc17' href='#sect17'>Author</a></li>
</ul>
</body>
</html>
